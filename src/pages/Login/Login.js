
import './Login.css';
import LoginInput from '../../components/LoginInput/LoginInput';
import { useForm } from "react-hook-form";
import { Slide, ToastContainer, toast } from 'react-toastify';
import 'react-toastify/dist/ReactToastify.css';
import React, { useState } from 'react';
import { login } from '../../services/authService';
import { useNavigate } from 'react-router-dom';

function Login() {

    const [error, setError] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const navigate = useNavigate();
    const { register, handleSubmit, formState: { errors, isValid } } = useForm();
    const onSubmit = async (data) => {
        const email = data.email;
        const password = data.password;
        setIsLoading(true);

        try {
            const token = await login(email, password);
            setError('');
            setIsLoading(false); // Desactiva el estado de carga después de iniciar sesión
            localStorage.setItem('token', token);
            navigate('/home');
        } catch (e) {
            setError(e.message);
            console.log(error);
            notify();
        }finally{
            setIsLoading(false); // Desactiva el estado de carga
        }
        
    }

    const notify = () => toast.error('Email incorrecto, prueba con eve.holt@reqres.in!', {
        position: "top-right",
        autoClose: 5000,
        hideProgressBar: false,
        closeOnClick: true,
        pauseOnHover: true,
        draggable: true,
        progress: undefined,
        theme: "light",
        transition: Slide,
        });;

    return (
        <div className="Login">
            <div className="left-section">  
                <section className="background">
                    <svg className="visual" id="visual" viewBox="0 0 900 600" preserveAspectRatio="xMinYMin slice" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1"><rect x="0" y="0" width="900" height="600" fill="#ffffff"></rect><path d="M470 0L464.7 33.3C459.3 66.7 448.7 133.3 433.7 200C418.7 266.7 399.3 333.3 415.7 400C432 466.7 484 533.3 510 566.7L536 600L0 600L0 566.7C0 533.3 0 466.7 0 400C0 333.3 0 266.7 0 200C0 133.3 0 66.7 0 33.3L0 0Z" fill="#ff6752"></path><path d="M345 0L352.8 33.3C360.7 66.7 376.3 133.3 365.2 200C354 266.7 316 333.3 313.2 400C310.3 466.7 342.7 533.3 358.8 566.7L375 600L0 600L0 566.7C0 533.3 0 466.7 0 400C0 333.3 0 266.7 0 200C0 133.3 0 66.7 0 33.3L0 0Z" fill="#fc6049"></path><path d="M181 0L185.7 33.3C190.3 66.7 199.7 133.3 204.8 200C210 266.7 211 333.3 219.5 400C228 466.7 244 533.3 252 566.7L260 600L0 600L0 566.7C0 533.3 0 466.7 0 400C0 333.3 0 266.7 0 200C0 133.3 0 66.7 0 33.3L0 0Z" fill="#f9593f"></path></svg>
                    <svg className="logo" version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet">
                    <path d="M0 0 C0.8916687 -0.00100708 1.7833374 -0.00201416 2.70202637 -0.00305176 C16.62386144 0.00757417 30.09698165 0.71169451 43.8125 3.25 C45.07682861 3.4668042 45.07682861 3.4668042 46.36669922 3.68798828 C90.5041335 11.26951827 131.82125717 31.21146893 165.8125 60.25 C166.54984375 60.87519531 167.2871875 61.50039063 168.046875 62.14453125 C181.87317948 74.23062844 195.10290047 87.29951698 205.8125 102.25 C206.24933105 102.84780273 206.68616211 103.44560547 207.13623047 104.06152344 C236.02823417 143.75301578 255.75444485 193.47293587 256.015625 243.0078125 C256.02268463 243.90552872 256.02974426 244.80324493 256.03701782 245.72816467 C256.26859478 283.83491372 256.26859478 283.83491372 252.8125 301.25 C252.61914062 302.23274902 252.42578125 303.21549805 252.2265625 304.22802734 C244.52396037 341.91491016 228.95492139 377.50605333 205.8125 408.25 C205.3995166 408.80719727 204.9865332 409.36439453 204.56103516 409.93847656 C164.04064573 464.41571458 102.31007083 498.75676808 35.68823242 508.86450195 C28.37369272 509.84503156 21.20367245 510.42426638 13.8203125 510.48828125 C12.88485596 510.4980751 11.94939941 510.50786896 10.9855957 510.51795959 C-9.39811732 510.6873951 -29.1804315 510.62004319 -49.1875 506.25 C-50.21375488 506.03037598 -51.24000977 505.81075195 -52.29736328 505.58447266 C-93.95509671 496.44293246 -133.2537726 477.68240722 -165.1875 449.25 C-165.7853833 448.73606689 -166.3832666 448.22213379 -166.99926758 447.69262695 C-179.81981201 436.64887299 -192.03805079 424.59828141 -201.99755859 410.88427734 C-203.18250808 409.25685595 -204.39506057 407.65339432 -205.61328125 406.05078125 C-217.05716274 390.77094907 -226.83612349 373.86890991 -234.1875 356.25 C-234.5479541 355.38777832 -234.9084082 354.52555664 -235.27978516 353.63720703 C-244.42200834 331.38346991 -250.44409449 308.15567127 -253.1875 284.25 C-253.2803125 283.54464111 -253.373125 282.83928223 -253.46875 282.11254883 C-260.94437206 219.55093669 -242.5707505 151.4818328 -203.625 101.8125 C-202.28236763 100.15286057 -200.92408393 98.5087726 -199.55126953 96.87402344 C-198.16396066 95.22196854 -196.79869219 93.55324292 -195.43359375 91.8828125 C-184.32786142 78.4589304 -172.02258884 65.86237527 -158.1875 55.25 C-157.25679688 54.49074219 -156.32609375 53.73148438 -155.3671875 52.94921875 C-119.29431781 24.02634241 -74.70765175 7.31189101 -29.1875 1.25 C-28.08281372 1.0953125 -28.08281372 1.0953125 -26.95581055 0.9375 C-18.0217277 -0.14506765 -8.98545989 0.00703185 0 0 Z " fill="#FEFDFD" transform="translate(254.1875,-0.25)"/>
                    <path d="M0 0 C1.97097258 0.68057273 3.92262418 1.40234124 5.87646484 2.13037109 C7.74431641 2.75878906 7.74431641 2.75878906 9.64990234 3.39990234 C17.19587422 5.977973 24.5667452 8.94893871 31.87646484 12.13037109 C32.99537109 12.60474609 34.11427734 13.07912109 35.26708984 13.56787109 C47.77935089 19.05269785 47.77935089 19.05269785 51.87646484 24.13037109 C52.36876663 25.61986942 52.83074532 27.11962385 53.26708984 28.62646484 C54.6137424 31.75701132 55.3324453 32.87437099 58.45239258 34.3425293 C61.81088492 35.20650165 65.14021782 35.82922566 68.56396484 36.38037109 C71.01536244 36.84451409 73.46589212 37.31326478 75.91552734 37.78662109 C77.10823242 38.00833984 78.3009375 38.23005859 79.52978516 38.45849609 C83.92339357 39.34055112 88.16829683 40.5340148 92.43896484 41.88037109 C96.77499791 43.24223361 100.99806395 44.39001194 105.50146484 45.06787109 C110.41571461 45.94841073 113.68141488 48.33624926 116.87646484 52.13037109 C120.65464722 58.06389241 119.45833591 65.92271476 118.25927734 72.53271484 C114.91257002 85.46048251 108.8782053 98.18635491 99.87646484 108.13037109 C99.30798828 108.79037109 98.73951172 109.45037109 98.15380859 110.13037109 C83.56581834 125.98822886 61.99956757 133.51110842 41.39794922 137.19677734 C34.86858493 138.45034887 29.63584949 139.65168908 25.30957031 145.10571289 C23.22104032 149.51368531 22.9513622 153.86076108 22.48974609 158.68115234 C22.32964302 160.20206734 22.32964302 160.20206734 22.16630554 161.75370789 C21.82908005 164.98236634 21.50881096 168.2124493 21.18896484 171.44287109 C20.96286846 173.63634591 20.73566758 175.82970718 20.50732422 178.02294922 C19.95089639 183.39083972 19.40836828 188.75999807 18.87646484 194.13037109 C16.11949389 193.71184026 13.36722386 193.27597157 10.61474609 192.82958984 C9.83587036 192.71321167 9.05699463 192.5968335 8.2545166 192.47692871 C4.03984907 191.77842096 1.03264203 191.26419237 -1.93603516 187.94287109 C-3.12744141 186.06396484 -3.12744141 186.06396484 -4.12353516 184.13037109 C-4.69394531 183.25058594 -4.69394531 183.25058594 -5.27587891 182.35302734 C-7.73486852 178.21387401 -8.46212479 174.38868648 -9.06103516 169.63037109 C-9.94689088 162.87278141 -11.87598082 158.03287278 -16.99853516 153.45458984 C-20.87365967 151.03976041 -24.73013435 151.3572834 -29.12353516 152.13037109 C-40.20147148 156.79560911 -45.99500804 165.57747723 -50.44384766 176.31787109 C-52.76475204 182.87755294 -54.19796092 188.96581837 -54.78759766 195.92333984 C-54.88991699 197.12039551 -54.99223633 198.31745117 -55.09765625 199.55078125 C-55.27860986 201.93968913 -55.42092275 204.33190511 -55.52050781 206.72558594 C-56.1161547 214.98227836 -56.1161547 214.98227836 -59.1003418 218.38330078 C-61.36803075 220.15105421 -63.66335173 221.64723719 -66.12353516 223.13037109 C-80.93906606 234.45840021 -91.68371015 252.4686016 -97.12353516 270.13037109 C-97.55863826 271.48228644 -97.99492694 272.83382055 -98.43212891 274.18505859 C-101.03760503 282.32119982 -103.12503488 289.86758121 -103.68603516 298.44287109 C-103.81171875 300.32425781 -103.81171875 300.32425781 -103.93994141 302.24365234 C-104.00052734 303.19626953 -104.06111328 304.14888672 -104.12353516 305.13037109 C-108.03247129 303.4291715 -111.24105271 300.88046284 -114.56103516 298.25537109 C-115.17358154 297.77140869 -115.78612793 297.28744629 -116.41723633 296.78881836 C-136.46759046 280.74390151 -152.62731006 261.55997272 -165.12353516 239.13037109 C-165.75775391 238.01017578 -166.39197266 236.88998047 -167.04541016 235.73583984 C-171.69734745 227.08280969 -171.69734745 227.08280969 -170.12353516 221.13037109 C-167.01680452 212.63779186 -161.54723999 207.5611911 -154.69775391 202.07177734 C-134.34535936 185.6477251 -113.47151843 160.33359915 -110.58056641 133.57958984 C-110.04152831 127.72988772 -109.78876888 121.8741811 -109.56103516 116.00537109 C-109.49625977 114.42755859 -109.49625977 114.42755859 -109.43017578 112.81787109 C-109.32535007 110.25546482 -109.22318161 107.6929831 -109.12353516 105.13037109 C-105.6977514 106.74708336 -103.46358822 108.59591639 -100.74853516 111.25537109 C-92.36823219 118.93113532 -81.96395734 124.70968909 -71.12353516 128.13037109 C-70.19541016 128.42814453 -69.26728516 128.72591797 -68.31103516 129.03271484 C-51.80858743 133.42123342 -31.11890226 133.51275895 -15.12353516 127.13037109 C-9.61886133 123.72240676 -6.13738747 121.37331325 -4.12353516 115.13037109 C-3.93177545 112.3977953 -3.83854066 109.7959203 -3.87353516 107.06787109 C-3.88259888 105.93514771 -3.88259888 105.93514771 -3.8918457 104.77954102 C-4.00347676 98.41251155 -4.79727428 92.36052247 -6.12353516 86.13037109 C-6.35298828 84.95345703 -6.58244141 83.77654297 -6.81884766 82.56396484 C-8.1119257 76.14621433 -9.62396894 70.16813607 -12.12353516 64.13037109 C-12.43677734 63.27314453 -12.75001953 62.41591797 -13.07275391 61.53271484 C-20.75459815 40.64348927 -30.97905055 21.27085803 -42.8112793 2.44506836 C-44.12353516 0.13037109 -44.12353516 0.13037109 -44.12353516 -1.86962891 C-33.65038518 -7.10620389 -10.6590651 -3.42393974 0 0 Z " fill="#FF5D3C" transform="translate(279.12353515625,88.86962890625)"/>
                    <path d="M0 0 C1.98371032 2.97556548 2.42050294 4.92714603 2.93652344 8.39453125 C4.14252625 16.49466232 6.13872536 23.25046166 11 30 C11.45004395 30.66644531 11.90008789 31.33289063 12.36376953 32.01953125 C15.58052218 36.3021045 17.98293437 38.43981427 23.3359375 39.375 C25.34617466 39.60867115 27.35961188 39.81597175 29.375 40 C43.85577512 41.86397128 57.33343549 46.59074296 68 57 C68.81984375 57.78310547 68.81984375 57.78310547 69.65625 58.58203125 C73.66083999 63.10762657 75.17502929 68.21514558 76.9375 73.875 C79.2602353 81.30370298 81.9118209 87.007877 87 93 C87.4734082 93.5676709 87.94681641 94.1353418 88.43457031 94.72021484 C94.25962836 101.88659246 94.25962836 101.88659246 100.64526367 108.53393555 C102 110 102 110 102.34765625 112.4609375 C101.95266522 115.34570346 101.29575521 116.42226406 99.4375 118.625 C96.8526837 121.82871598 94.6820924 125.09554297 92.5625 128.625 C88.0231331 135.79660373 83.54626886 140.07331577 75.32421875 142.48828125 C72.28511746 143.15739431 69.26701954 143.42562928 66.171875 143.703125 C62.532408 144.2006061 59.35972363 145.56265345 56 147 C54.06290713 147.81347018 52.12537328 148.6258907 50.1875 149.4375 C48.65609375 150.08138672 48.65609375 150.08138672 47.09375 150.73828125 C43.26122436 152.3012936 39.3800005 153.69762988 35.484375 155.09375 C29.25010963 157.21840648 29.25010963 157.21840648 24 161 C23.69940057 163.36509361 23.50484988 165.74441881 23.375 168.125 C23.26285156 170.04699219 23.26285156 170.04699219 23.1484375 172.0078125 C23.07496094 173.48894531 23.07496094 173.48894531 23 175 C15.50816663 175.17952112 8.34719879 174.71419954 0.9375 173.625 C0.02162109 173.49867188 -0.89425781 173.37234375 -1.83789062 173.2421875 C-23.52705712 170.17224178 -57.75735832 163.24264168 -74 147 C-76.42928681 125.69395994 -66.36916603 100.02496908 -53.2890625 83.484375 C-50.62250938 80.23132716 -47.83652244 77.10565033 -45 74 C-44.3709375 73.30003906 -43.741875 72.60007812 -43.09375 71.87890625 C-38.66405962 67.1880313 -33.52606315 63.32371988 -28 60 C-27.34 60 -26.68 60 -26 60 C-26.02320313 59.20980469 -26.04640625 58.41960937 -26.0703125 57.60546875 C-26.35575711 39.76518091 -26.12737638 18.68950585 -13 5 C-5.85351898 -1.75605569 -5.85351898 -1.75605569 0 0 Z " fill="#FF5D3C" transform="translate(259,253)"/>
                    <path d="M0 0 C2.71503803 1.07222577 3.44148297 2.35020371 4.9753418 4.8125 C5.48887207 5.62847656 6.00240234 6.44445312 6.53149414 7.28515625 C7.03503418 8.11917969 7.53857422 8.95320313 8.05737305 9.8125 C8.50806152 10.55371094 8.95875 11.29492188 9.4230957 12.05859375 C12.2549426 16.79557805 14.97487728 21.59845649 17.69213867 26.40185547 C18.54729283 27.91183261 19.40722475 29.41912489 20.27416992 30.92236328 C32.60371373 52.37260809 43.22752664 77.82597492 43.61987305 102.875 C43.6348584 103.61943359 43.64984375 104.36386719 43.6652832 105.13085938 C43.59704351 108.57013971 43.31355368 110.4802155 41.19018555 113.234375 C30.67769703 121.01284636 10.90044399 118.51274317 -1.39575195 117.5390625 C-17.62814759 115.02351581 -30.59257925 105.35330436 -42.25512695 94.375 C-42.9200415 93.77896973 -43.58495605 93.18293945 -44.27001953 92.56884766 C-47.75140778 89.1504564 -49.35843593 86.8320152 -49.4309082 81.8671875 C-49.30890421 80.17885106 -49.1472784 78.4928222 -48.94262695 76.8125 C-48.83833374 75.73488403 -48.83833374 75.73488403 -48.73193359 74.63549805 C-45.93670173 49.98451989 -37.63000919 25.75472469 -17.94262695 9.8125 C-4.1619842 -0.40170967 -4.1619842 -0.40170967 0 0 Z " fill="#FF5D3C" transform="translate(220.942626953125,91.1875)"/>
                    <path d="M0 0 C3.625 0.375 3.625 0.375 6.0625 2.0625 C7.625 4.375 7.625 4.375 8.1875 6.875 C7.625 9.375 7.625 9.375 5.4375 11.6875 C2.37572428 13.52456543 1.1054429 14.088937 -2.375 13.375 C-4.75 11.8125 -4.75 11.8125 -6.375 9.375 C-6.18506265 3.86681691 -5.97675105 0.66408345 0 0 Z " fill="#FFF3F1" transform="translate(311.375,327.625)"/>
                    <path d="M0 0 C3.37013879 0.67402776 4.51677007 1.7087875 6.5 4.5 C7.0625 7.5 7.0625 7.5 6.5 10.5 C4.3125 12.9375 4.3125 12.9375 1.5 14.5 C-1.39481608 14.43107581 -2.90685358 13.88861317 -5.3125 12.3125 C-7.10972017 9.56937448 -6.95774125 7.70418874 -6.5 4.5 C-4.51677007 1.7087875 -3.37013879 0.67402776 0 0 Z " fill="#FFF5F3" transform="translate(305.5,134.5)"/>
                    <path d="M0 0 C0.33 0 0.66 0 1 0 C1 4.29 1 8.58 1 13 C-6.09209896 13.09092435 -12.95957136 12.85523645 -20 12 C-20 11.67 -20 11.34 -20 11 C-17.02111874 10.8061789 -14.04209754 10.61964898 -11.0625 10.4375 C-10.21236328 10.38142578 -9.36222656 10.32535156 -8.48632812 10.26757812 C-7.67744141 10.21923828 -6.86855469 10.17089844 -6.03515625 10.12109375 C-5.2862915 10.0739624 -4.53742676 10.02683105 -3.76586914 9.97827148 C-2 10 -2 10 -1 11 C-0.67 7.37 -0.34 3.74 0 0 Z " fill="#FF8770" transform="translate(281,415)"/>
                    <path d="M0 0 C0.33 0 0.66 0 1 0 C0.125 6.75 0.125 6.75 -1 9 C-1.66 9 -2.32 9 -3 9 C-2.01 6.03 -1.02 3.06 0 0 Z " fill="#FF6C4F" transform="translate(196,352)"/>
                    </svg>
                </section>
                
            </div>
            <div className="right-section">
                <h1 id='welcome'><span id='barra'/>Bienvenido</h1>
                <form className="login-form" onSubmit={handleSubmit(onSubmit)}>
                    <LoginInput type={"text"} text={"Email"} register={register("email", {required: true})}/>
                    <LoginInput type={"password"} text={"Contraseña"} register={register("password", {required: true, minLength:6})}/>  
                    <a id="forgot" href='/forgot'>¿Olvidaste tu contraseña?</a>
                    {errors.email?.type === "required" && (<p id="error">El email es obligatorio</p>) }
                    {errors.password?.type === "minLength" && (<p id="error">La contrase&ntilde;a debe tener al menos 6 caracteres</p>) }
                    <button disabled={!isValid || isLoading} type="submit" id="loginbtn" >
                    {isLoading ? <svg xmlns="http://www.w3.org/2000/svg" className="spinner" viewBox="0 0 24 24"><path fill="currentColor" d="M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"><animateTransform attributeName="transform" dur="0.75s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></svg> : null}
                    {isLoading ? "Cargando..." : "Iniciar Sesión"}
                    </button>
                    
                    <p id="aun">Aún no tengo cuenta <a id="register" href="/register">Registrarse</a></p>
                    
                </form>
            </div>
            <ToastContainer position='top-right' autoClose={2000} hideProgressBar={false} newestOnTop={false} closeOnClick rtl={false} pauseOnFocusLoss draggable pauseOnHover theme="light"/>
        </div>
    );
}

export default Login;